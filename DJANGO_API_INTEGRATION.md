# üîó Django API Integration

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é Expo React Native –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å Django API –Ω–∞ Railway.

## üéØ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

‚úÖ **–ü–æ–¥–∫–ª—é—á–µ–Ω —Ä–µ–∞–ª—å–Ω—ã–π Django API** –≤–º–µ—Å—Ç–æ –∑–∞–≥–ª—É—à–µ–∫  
‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** –Ω–∞ SMS-based flow  
‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è** —Å —Ä–µ–∞–ª—å–Ω—ã–º –±—ç–∫–µ–Ω–¥–æ–º  
‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω—ã –∞–¥–∞–ø—Ç–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö** –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏  
‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ fallback —Å–∏—Å—Ç–µ–º–∞** –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ API

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Node.js
node scripts/test-api.js
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Django API –∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤.

### 2. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã)
npm install

# –ó–∞–ø—É—Å–∫ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
npm start
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π

1. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**:

   - –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å ‚Üí –Ω–∞–∂–º–∏—Ç–µ "–í–æ–π—Ç–∏"
   - –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ ‚Üí –ø–æ–ª—É—á–∏—Ç–µ SMS –∫–æ–¥
   - –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥

2. **–†–µ—Å—Ç–æ—Ä–∞–Ω—ã**:

   - –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏–∑ Django API
   - –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è mock –¥–∞–Ω–Ω—ã–µ

3. **–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**:
   - –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω ‚Üí "–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–æ–ª–∏–∫"
   - –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É ‚Üí —Å–æ–∑–¥–∞–µ—Ç—Å—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ API
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª–µ "–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è"

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### API Configuration

–ë–∞–∑–æ–≤—ã–π URL –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ `lib/api/config.ts`:

```typescript
export const API_BASE_URL = "https://api-production-4ce8.up.railway.app";
```

### Environment Variables (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–í—ã –º–æ–∂–µ—Ç–µ –≤—ã–Ω–µ—Å—Ç–∏ URL –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
# .env
EXPO_PUBLIC_API_URL=https://api-production-4ce8.up.railway.app
```

```typescript
// lib/api/config.ts
export const API_BASE_URL =
  process.env.EXPO_PUBLIC_API_URL ||
  "https://api-production-4ce8.up.railway.app";
```

## üì± SMS –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

### –ù–æ–≤—ã–π Flow

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è**:

   ```
   –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ ‚Üí SMS –∫–æ–¥ ‚Üí –õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Üí –ê–≤—Ç–æ–≤—Ö–æ–¥
   ```

2. **–í—Ö–æ–¥**:
   ```
   –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ ‚Üí SMS –∫–æ–¥ ‚Üí –ê–≤—Ç–æ–≤—Ö–æ–¥
   ```

### API Endpoints

- `POST /api/auth/send-verification-code/` - –û—Ç–ø—Ä–∞–≤–∫–∞ SMS –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- `POST /api/auth/verify-phone/` - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞
- `POST /api/auth/login/send-code/` - –û—Ç–ø—Ä–∞–≤–∫–∞ SMS –¥–ª—è –≤—Ö–æ–¥–∞
- `POST /api/auth/login/verify-code/` - –í—Ö–æ–¥ –ø–æ SMS –∫–æ–¥—É

## üçΩÔ∏è –†–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

- ‚úÖ –°–ø–∏—Å–æ–∫ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
- ‚úÖ –î–µ—Ç–∞–ª–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏
- ‚úÖ –û—Ç–º–µ–Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π

### API Endpoints

- `GET /api/restaurant/restaurants/` - –°–ø–∏—Å–æ–∫ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤
- `GET /api/restaurant/restaurants/{id}/` - –î–µ—Ç–∞–ª–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞
- `POST /api/restaurant/bookings/` - –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- `GET /api/restaurant/bookings/` - –ú–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- `DELETE /api/restaurant/bookings/{id}/` - –û—Ç–º–µ–Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

## üîÑ Fallback System

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–º–µ–µ—Ç —É–º–Ω—É—é —Å–∏—Å—Ç–µ–º—É fallback:

1. **–†–µ—Å—Ç–æ—Ä–∞–Ω—ã**: –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è mock –¥–∞–Ω–Ω—ã–µ
2. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: –¢—Ä–µ–±—É–µ—Ç —Ä–∞–±–æ—Ç–∞—é—â–∏–π API (SMS –∫–æ–¥—ã)
3. **–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**: –¢—Ä–µ–±—É–µ—Ç —Ä–∞–±–æ—Ç–∞—é—â–∏–π API –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é

## üêõ Troubleshooting

### API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å API
curl https://api-production-4ce8.up.railway.app/api/health/

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
node scripts/test-api.js
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (+7xxxxxxxxx)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –Ω–∞ –æ—à–∏–±–∫–∏

### –ü—Ä–æ–±–ª–µ–º—ã —Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–∞—Ç–∞ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (YYYY-MM-DD)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Ä–µ–º—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (HH:MM)

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ API –≤—ã–∑–æ–≤—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏:

- üöÄ - –ù–∞—á–∞–ª–æ –∑–∞–ø—Ä–æ—Å–∞
- ‚úÖ - –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç
- ‚ùå - –û—à–∏–±–∫–∞
- üîÑ - –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞
- üåê - –°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏

### Performance

- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: React Query –∫—ç—à–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ 5-10 –º–∏–Ω—É—Ç
- **Offline mode**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–∫–∞—Ö
- **Retry logic**: –£–º–Ω—ã–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –¢–æ–∫–µ–Ω—ã

- **Access Token**: –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ ~60 –º–∏–Ω—É—Ç
- **Refresh Token**: –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ ~30 –¥–Ω–µ–π
- **–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –ü—Ä–∏ 401 –æ—à–∏–±–∫–µ —Ç–æ–∫–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

### –î–∞–Ω–Ω—ã–µ

- **–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ**: –¢–æ–∫–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º AsyncStorage
- **HTTPS**: –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ –∑–∞—â–∏—â–µ–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –°—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

## üìà –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–î–æ–±–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤** –∏–∑ Django API
2. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å—á–µ—Ç–∞ (bills)** —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
3. **–†–∞—Å—à–∏—Ä–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã** —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤
4. **–î–æ–±–∞–≤–∏—Ç—å push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
5. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** –∏ offline —Ä–µ–∂–∏–º

## ü§ù –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö API endpoints

1. –î–æ–±–∞–≤—å—Ç–µ —Ç–∏–ø—ã –≤ `lib/api/types.ts`
2. –°–æ–∑–¥–∞–π—Ç–µ API —Ñ—É–Ω–∫—Ü–∏—é –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º —Ñ–∞–π–ª–µ (`lib/api/`)
3. –î–æ–±–∞–≤—å—Ç–µ –∞–¥–∞–ø—Ç–µ—Ä –≤ `lib/api/*Adapters.ts`
4. –°–æ–∑–¥–∞–π—Ç–µ —Ö—É–∫ –≤ `hooks/api/`
5. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
lib/api/
‚îú‚îÄ‚îÄ config.ts          # –ë–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ auth.ts            # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è API
‚îú‚îÄ‚îÄ smsAuth.ts         # SMS –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îú‚îÄ‚îÄ restaurant.ts      # –†–µ—Å—Ç–æ—Ä–∞–Ω—ã –∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ types.ts           # TypeScript —Ç–∏–ø—ã
‚îú‚îÄ‚îÄ adapters.ts        # –ê–¥–∞–ø—Ç–µ—Ä—ã –¥–ª—è auth
‚îú‚îÄ‚îÄ restaurantAdapters.ts # –ê–¥–∞–ø—Ç–µ—Ä—ã –¥–ª—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤
‚îî‚îÄ‚îÄ index.ts           # –≠–∫—Å–ø–æ—Ä—Ç—ã

hooks/api/
‚îú‚îÄ‚îÄ useAuth.ts         # –•—É–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ useSmsAuth.ts      # SMS –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ö—É–∫–∏
‚îî‚îÄ‚îÄ useRestaurantsApi.ts # –†–µ—Å—Ç–æ—Ä–∞–Ω—ã API —Ö—É–∫–∏
```

---

**üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É Django API.**
